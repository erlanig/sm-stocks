<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulasi Monte Carlo Saham</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0d0f1a;
    --surface: #161929;
    --surface2: #1e2235;
    --border: #2a2d40;
    --blue: #4f9cf9;
    --blue-dim: rgba(79,156,249,0.12);
    --green: #22c55e;
    --red: #ef4444;
    --yellow: #f59e0b;
    --text: #e2e8f0;
    --muted: #64748b;
    --radius: 12px;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
  }
  .page { width: 100%; max-width: 680px; }
  .hero { text-align: center; margin-bottom: 36px; }
  .logo {
    display: inline-flex; align-items: center; gap: 10px;
    background: var(--blue-dim); border: 1px solid rgba(79,156,249,0.3);
    padding: 6px 14px; border-radius: 99px; font-size: 13px; color: var(--blue);
    margin-bottom: 24px;
  }
  .logo-dot { width: 8px; height: 8px; background: var(--blue); border-radius: 50%; animation: pulse 2s infinite; }
  @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.4; } }
  h1 { font-size: 2.4rem; font-weight: 700; line-height: 1.15; margin-bottom: 10px; }
  h1 span { color: var(--blue); }
  .subtitle { color: var(--muted); font-size: 1rem; }
  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 18px;
    padding: 32px;
    margin-bottom: 16px;
  }
  .field-group { margin-bottom: 24px; }
  .field-label {
    display: block; font-size: 13px; font-weight: 600;
    color: var(--muted); text-transform: uppercase; letter-spacing: 0.06em;
    margin-bottom: 8px;
  }
  .ticker-wrap { position: relative; }
  .ticker-wrap input {
    width: 100%;
    background: var(--surface2);
    border: 1.5px solid var(--border);
    border-radius: var(--radius);
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 1.5rem;
    font-weight: 500;
    padding: 14px 140px 14px 20px;
    outline: none;
    transition: border-color 0.2s;
    letter-spacing: 0.05em;
    text-transform: uppercase;
  }
  .ticker-wrap input::placeholder { font-size: 1rem; letter-spacing: 0; font-weight: 400; color: #3a3f55; font-family: 'DM Sans', sans-serif; }
  .ticker-wrap input:focus { border-color: var(--blue); }
  .ticker-badge {
    position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
    background: var(--blue-dim); color: var(--blue); border: 1px solid rgba(79,156,249,0.3);
    border-radius: 6px; padding: 4px 10px; font-size: 12px; font-weight: 600;
    pointer-events: none;
  }
  .ticker-hint { font-size: 12px; color: var(--muted); margin-top: 7px; }
  .chips { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 10px; }
  .chip {
    background: var(--surface2); border: 1px solid var(--border);
    color: var(--text); font-size: 12px; font-weight: 500;
    padding: 4px 10px; border-radius: 6px; cursor: pointer;
    font-family: 'DM Mono', monospace; transition: all 0.15s;
  }
  .chip:hover { border-color: var(--blue); color: var(--blue); background: var(--blue-dim); }
  .chip-label { font-family: 'DM Sans', sans-serif; font-size: 11px; color: var(--muted); align-self: center; margin-right: 2px; }
  .grid3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }
  .field-box { background: var(--surface2); border: 1.5px solid var(--border); border-radius: var(--radius); padding: 16px 18px; }
  .field-box:focus-within { border-color: var(--blue); }
  .field-box .lbl { font-size: 11px; color: var(--muted); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 6px; }
  .field-box .sub { font-size: 10px; color: #3a3f55; margin-top: 4px; }
  .field-box input {
    width: 100%; background: transparent; border: none; outline: none;
    color: var(--text); font-size: 1.3rem; font-weight: 600; font-family: 'DM Mono', monospace;
  }
  input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { opacity: 0; }
  .range-row { display: flex; gap: 8px; margin-top: 8px; }
  .range-btn {
    flex: 1; background: var(--surface2); border: 1px solid var(--border);
    color: var(--muted); font-size: 11px; font-family: 'DM Sans', sans-serif;
    border-radius: 6px; padding: 4px 0; cursor: pointer; transition: all 0.15s; text-align: center;
  }
  .range-btn:hover { border-color: var(--blue); color: var(--blue); background: var(--blue-dim); }
  .days-hint { font-size: 11px; color: #4f9cf9; margin-top: 5px; }
  .btn-run {
    width: 100%; background: var(--blue); color: #fff;
    border: none; border-radius: var(--radius); font-family: 'DM Sans', sans-serif;
    font-size: 1rem; font-weight: 700; padding: 16px; cursor: pointer;
    transition: opacity 0.2s, transform 0.15s; letter-spacing: 0.01em;
    display: flex; align-items: center; justify-content: center; gap: 10px;
  }
  .btn-run:hover { opacity: 0.88; transform: translateY(-1px); }
  .btn-run:active { transform: translateY(0); }
  .loading-state { display: none; flex-direction: column; align-items: center; gap: 10px; padding: 10px 0; }
  .spinner {
    width: 28px; height: 28px; border: 3px solid var(--border);
    border-top-color: var(--blue); border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .info-cards { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  .info-card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: var(--radius); padding: 16px;
  }
  .info-card h4 { font-size: 13px; font-weight: 600; margin-bottom: 6px; }
  .info-card p { font-size: 12px; color: var(--muted); line-height: 1.6; }
  .info-card.blue { border-top: 2px solid var(--blue); }
  .info-card.green { border-top: 2px solid var(--green); }
  .info-card.red { border-top: 2px solid var(--red); }
  .info-card.yellow { border-top: 2px solid var(--yellow); }
  .calc-link {
    display: flex; align-items: center; justify-content: center; gap: 6px;
    color: var(--muted); font-size: 12px; text-decoration: none;
    margin-top: 16px; transition: color 0.2s;
  }
  .calc-link:hover { color: var(--blue); }
  @media (max-width: 560px) {
    .grid3 { grid-template-columns: 1fr; }
    .info-cards { grid-template-columns: 1fr; }
    h1 { font-size: 1.7rem; }
  }
</style>
</head>
<body>
<div class="page">
  <div class="hero">
    <div class="logo"><div class="logo-dot"></div> Monte Carlo Simulator</div>
    <h1>Prediksi Harga <span>Saham</span></h1>
    <p class="subtitle">Simulasi ribuan skenario pergerakan harga secara statistik</p>
  </div>

  <div class="card">
    <form id="form" action="/simulate" method="POST" onsubmit="onSubmit()">
      <!-- Ticker -->
      <div class="field-group">
        <label class="field-label">Kode Saham</label>
        <div class="ticker-wrap">
          <input type="text" name="ticker" id="ticker" placeholder="Tulis kode saham..."
                 autocomplete="off" spellcheck="false" required>
          <div class="ticker-badge" id="exBadge">AUTO</div>
        </div>
        <p class="ticker-hint" id="tickerHint">Ketik kode ‚Äî sistem otomatis mengenali IDX (.JK) atau US</p>
        <div class="chips" style="margin-top:10px;">
          <span class="chip-label">IDX:</span>
          <span class="chip" onclick="setTicker('BBCA')">BBCA</span>
          <span class="chip" onclick="setTicker('BBRI')">BBRI</span>
          <span class="chip" onclick="setTicker('BMRI')">BMRI</span>
          <span class="chip" onclick="setTicker('TLKM')">TLKM</span>
          <span class="chip" onclick="setTicker('GOTO')">GOTO</span>
          <span class="chip" onclick="setTicker('ASII')">ASII</span>
          <span class="chip-label" style="margin-left:6px;">US:</span>
          <span class="chip" onclick="setTicker('AAPL')">AAPL</span>
          <span class="chip" onclick="setTicker('MSFT')">MSFT</span>
          <span class="chip" onclick="setTicker('NVDA')">NVDA</span>
          <span class="chip" onclick="setTicker('TSLA')">TSLA</span>
        </div>
      </div>

      <!-- Params -->
      <div class="grid3" style="margin-bottom:24px;">
        <div class="field-box">
          <div class="lbl">Hari Prediksi</div>
          <input type="number" name="days" id="days" value="30" min="1" max="504" oninput="updateDayHint()">
          <div class="days-hint" id="dayHint">‚âà 1 bulan trading</div>
          <div class="range-row">
            <button type="button" class="range-btn" onclick="setDays(30)">1 bln</button>
            <button type="button" class="range-btn" onclick="setDays(63)">3 bln</button>
            <button type="button" class="range-btn" onclick="setDays(126)">6 bln</button>
            <button type="button" class="range-btn" onclick="setDays(252)">1 thn</button>
          </div>
        </div>
        <div class="field-box">
          <div class="lbl">Jumlah Simulasi</div>
          <input type="number" name="simulations" id="sims" value="1000" min="100" max="10000">
          <div class="sub">min 100 ¬∑ maks 10.000</div>
          <div class="range-row">
            <button type="button" class="range-btn" onclick="setSims(500)">500</button>
            <button type="button" class="range-btn" onclick="setSims(1000)">1K</button>
            <button type="button" class="range-btn" onclick="setSims(5000)">5K</button>
          </div>
        </div>
        <div class="field-box">
          <div class="lbl">Data Historis</div>
          <input type="number" name="years" id="years" value="3" min="1" max="10">
          <div class="sub">tahun ke belakang</div>
          <div class="range-row">
            <button type="button" class="range-btn" onclick="setYears(1)">1 thn</button>
            <button type="button" class="range-btn" onclick="setYears(3)">3 thn</button>
            <button type="button" class="range-btn" onclick="setYears(5)">5 thn</button>
          </div>
        </div>
      </div>

      <button type="submit" class="btn-run" id="btnRun">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polygon points="5 3 19 12 5 21 5 3"/></svg>
        Jalankan Simulasi
      </button>
      <div class="loading-state" id="loading">
        <div class="spinner"></div>
        <span style="color:var(--muted);font-size:13px;">Mengambil data & menjalankan simulasi...</span>
      </div>
    </form>
  </div>

  <div class="info-cards">
    <div class="info-card blue">
      <h4>üìà Monte Carlo</h4>
      <p>Ribuan jalur harga acak berdasarkan volatilitas historis. Hasilnya adalah distribusi probabilitas harga masa depan.</p>
    </div>
    <div class="info-card red">
      <h4>‚ö†Ô∏è Value at Risk</h4>
      <p>VaR 95% = kerugian maksimal yang mungkin terjadi dengan probabilitas 95%. Ukuran standar manajemen risiko.</p>
    </div>
    <div class="info-card green">
      <h4>üìä Percentile</h4>
      <p>P5 = skenario terburuk 5% simulasi. P95 = skenario terbaik. 90% skenario ada di antara keduanya.</p>
    </div>
    <div class="info-card yellow">
      <h4>üìÖ Hari Trading</h4>
      <p>1 tahun = 252 hari trading (hari bursa). 1 bulan ‚âà 21 hari. Gunakan tombol preset di atas.</p>
    </div>
  </div>

  <a href="/calculation" class="calc-link">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
    Lihat detail rumus & cara perhitungan Monte Carlo
  </a>
</div>

<script>
const IDX = new Set(['BBCA','BBRI','BMRI','TLKM','ASII','UNVR','GOTO','BYAN','BUKA','INDF',
  'GGRM','HMSP','ANTM','KLBF','CPIN','MDKA','ICBP','PGAS','JSMR','ADRO',
  'PTBA','INCO','TPIA','SMGR','TOWR','SIDO','MYOR','HEAL','EXCL','ISAT',
  'BBNI','BRIS','ARTO','EMTK','ESSA','DOID','MBMA','AMMN','NICE','HRUM']);
const US = new Set(['AAPL','MSFT','GOOGL','AMZN','META','TSLA','NVDA','NFLX','AMD','INTC',
  'JPM','BAC','V','MA','DIS','UBER','ABNB','PLTR','COIN','RBLX','SHOP']);

function detectExchange(t) {
  if (!t) return {label:'AUTO', hint:'Ketik kode ‚Äî sistem otomatis mengenali IDX atau US'};
  if (t.includes('.')) return {label: t.split('.')[1], hint:`Exchange eksplisit: ${t}`};
  if (US.has(t)) return {label:'NYSE/NASDAQ', hint:`Terdeteksi saham AS ‚Äî akan digunakan langsung sebagai ${t}`};
  if (IDX.has(t)) return {label:'IDX', hint:`Terdeteksi saham Indonesia ‚Äî akan digunakan sebagai ${t}.JK`};
  if (t.length <= 4 && /^[A-Z]+$/.test(t)) return {label:'IDX?', hint:`Kode pendek ‚Äî diasumsikan IDX, akan dicoba ${t}.JK`};
  return {label:'US?', hint:`Akan dicoba sebagai saham US: ${t}`};
}

document.getElementById('ticker').addEventListener('input', function() {
  const v = this.value.trim().toUpperCase();
  this.value = v;
  const {label, hint} = detectExchange(v);
  document.getElementById('exBadge').textContent = label;
  document.getElementById('tickerHint').textContent = hint;
});

function setTicker(t) {
  document.getElementById('ticker').value = t;
  document.getElementById('ticker').dispatchEvent(new Event('input'));
}
function setDays(d) { document.getElementById('days').value = d; updateDayHint(); }
function setSims(s) { document.getElementById('sims').value = s; }
function setYears(y) { document.getElementById('years').value = y; }

function updateDayHint() {
  const d = parseInt(document.getElementById('days').value) || 0;
  const hint = document.getElementById('dayHint');
  if (d <= 5) hint.textContent = `‚âà 1 minggu trading`;
  else if (d <= 21) hint.textContent = `‚âà ${Math.round(d/5)} minggu trading`;
  else if (d <= 252) hint.textContent = `‚âà ${(d/21).toFixed(1)} bulan trading`;
  else hint.textContent = `‚âà ${(d/252).toFixed(1)} tahun trading`;
  hint.style.color = d > 252 ? '#f59e0b' : '#4f9cf9';
}

function onSubmit() {
  document.getElementById('btnRun').style.display = 'none';
  document.getElementById('loading').style.display = 'flex';
}
</script>
</body>
</html>